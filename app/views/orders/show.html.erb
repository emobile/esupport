<%content_for :breadcrumb do%>
  <ul class="breadcrumb">
    <%if can? :show, Order and @is_user%>
      <li><%=link_to @current_user.branch.name, @current_user.branch%><span class="divider">/</span></li>
    <%end%>
    <%if can? :index, Order%>
      <li><%=link_to t(:index), orders_path%><span class="divider">/</span></li>
    <%end%>
    <li class="active"><%=@order.identifier%></li>
  </ul>
<%end%>

<div class="row-fluid">
  <div class="block span6">
    <a href="#client-info" class="block-heading" data-toggle="collapse"><%= t(:client_info) %></a>
    <div id="client-info" class="block-body collapse in">
      <br>
      <p>
        <b><%= t'.email' %>:</b>
        <%=  mail_to @order.client.email, @order.client.email%>
      </p>

      <p>
        <b><%= t'.phone1'  %>:</b>
        <%= @order.client.phone1 %>
      </p>

      <p>
        <b> <%=t'.phone2' %>:</b>
        <%= @order.client.phone2 %>
      </p>

      <p>
        <b><%=t'.address1'%>:</b>
        <%= @order.client.address1 %>
      </p>

      <p>
        <b><%=t'.address2'%>:</b>
        <%= @order.client.address2 %>
      </p>

      <p>
        <b><%=t'.city'%>:</b>
        <%= @order.client.city %>
      </p>

      <p>
        <b><%=t'.state'%>:</b>
        <%= @order.client.state %>
      </p>

      <p>
        <b><%= t'.zip' %>:</b>
        <%= @order.client.zip %>
      </p>

      <p>
        <b><%=t'.country'%>:</b>
        <%= @order.client.country %>
      </p>
      <%if can? :edit, Client%>
        <%= link_to t(:edit_client_info),
          edit_client_path(@order.client), :class => 'btn btn-primary' %>
      <%end%>
      <br>        <br>
    </div>
  </div>
  <div class="block span6">
    <a href="#billing-info" class="block-heading" data-toggle="collapse"><%= t(:bill_info) %></a>
    <div id="billing-info" class="block-body collapse in">
      <br>
      <%@bill = Bill.find_by_client_id(@order.client_id)%>
      <p>
        <b><%=t'.client_id' %>:</b>
        <%= @bill.client.fullname %>
      </p>
      <p>
        <b><%=t'.name' %>: </b>
        <%= @bill.name %>
      </p>

      <p>
        <b><%=t'.rfc'%>:</b>
        <%= @bill.rfc %>
      </p>

      <p>
        <b><%=t'.email'%>:</b>
        <%= @bill.email %>
      </p>

      <p>
        <b><%=t'.phone1'%>:</b>
        <%= @bill.phone1 %>
      </p>

      <p>
        <b><%=t'.phone2'%>:</b>
        <%= @bill.phone2 %>
      </p>

      <p>
        <b><%=t'.fax'%>:</b>
        <%= @bill.fax %>
      </p>
      <p>
        <b><%=t'.address1'%>:</b>
        <%= @bill.address1 %>
      </p>

      <p>
        <b><%=t'.address2'%>:</b>
        <%= @bill.address2 %>
      </p>
      <p>
        <b><%=t'.zip'%>:</b>
        <%= @bill.zip %>
      </p>

      <p>
        <b><%=t'.city'%>:</b>
        <%= @bill.city %>
      </p>

      <p>
        <b><%=t'.state'%>:</b>
        <%= @bill.state %>
      </p>

      <p>
        <b><%=t'.country'%>:</b>
        <%= @bill.country %>
      </p>
      <%if can? :edit, Bill%>
        <%= link_to t(:edit_bill_info),
          edit_client_path(@order.bill), :class => 'btn btn-primary' %>
      <%end%>
      <br>        <br>
    </div>
  </div>
</div>

<div class="row-fluid">
  <div class="block span6" >
    <a href="#product_info" class="block-heading" data-toggle="collapse"><%= t(:devise_info)%></a>
    <div id="product_info" class="block-body collapse in">
      <br />
      <p>
        <b><%=t'.status'%>:</b>
        <%= @order.status.name %>
      </p>
      <p>
        <b><%=t'.divise'%>:</b>
        <%= link_to eval("t(:#{@order.product_type})"), eval("@product.#{@order.product_type.downcase.singularize}") %>
      </p>
      <p>
        <b><%=t(:delivery_date)%>:</b>
        <%= @order.delivery_date %>
      </p>
    </div>
  </div>   
  <div class="block span6">
    <a href="#workshop_info" class="block-heading" data-toggle="collapse"><%= t(:workshop_info)%></a>
    <div id="workshop_info" class="block-body collapse in">
      <br />
      <p>
        <b>Name:</b>
        <%= @order.workshop.name %>
      </p>

      <p>
        <b>Email1:</b>
        <%= @order.workshop.email1 %>
      </p>

      <p>
        <b>Email2:</b>
        <%= @order.workshop.email2 %>
      </p>

      <p>
        <b>Phone1:</b>
        <%= @order.workshop.phone1 %>
      </p>

      <p>
        <b>Phone2:</b>
        <%= @order.workshop.phone2 %>
      </p>

      <p>
        <b>Fax:</b>
        <%= @order.workshop.fax %>
      </p>

      <p>
        <b>Address1:</b>
        <%= @order.workshop.address1 %>
      </p>

      <p>
        <b>Address2:</b>
        <%= @order.workshop.address2 %>
      </p>

      <p>
        <b>Zip:</b>
        <%= @order.workshop.zip %>
      </p>

      <p>
        <b>City:</b>
        <%= @order.workshop.city %>
      </p>

      <p>
        <b>State:</b>
        <%= @order.workshop.state %>
      </p>

      <p>
        <b>Country:</b>
        <%= @order.workshop.country %>
      </p>

      <p>
        <b>Description:</b>
        <%= @order.workshop.description %>
      </p>

      <p>
        <b>Manager:</b>
        <%= @order.workshop.user.fullname %>
      </p>

      <p>
        <b>Branch:</b>
        <%= @order.workshop.branch.name %>
      </p>

      <%if can? :edit, Workshop%>
        <%= link_to t(:edit_workshop_info),
          edit_client_path(@order.workshop), :class => 'btn btn-primary' %>
      <%end%>
      <br>        <br>
    </div>
  </div>   
</div>


<div class="row-fluid">
  <div class="block span6" >
    <a href="#condition_info" class="block-heading" data-toggle="collapse"><%= t(:condition)%></a>
    <div id="condition_info" class="block-body collapse in">
      <br />
      <div class="field">
        <%= raw(@order.condition) %>
        <br />
      </div>
    </div>
  </div>   
  <div class="block span6" >
    <a href="#failure_info" class="block-heading" data-toggle="collapse"><%= t(:failure)%></a>
    <div id="failure_info" class="block-body collapse in">
      <br />
      <div class="field">
        <%= raw(@order.failure) %>
        <br />
      </div>
    </div>
  </div>
</div>

<div class="row-fluid">
  <div class="block span6" >
    <a href="#comments_info" class="block-heading" data-toggle="collapse"><%= t(:wcomments)%></a>
    <div id="comments_info" class="block-body collapse in">
      <br />
      <div class="field">
        <%= raw(@order.comments) %>
        <br />
      </div>
    </div>
  </div>   
  <div class="block span6">
    <a href="#accessories_info" class="block-heading" data-toggle="collapse"><%= t(:accessories)%></a>
    <div id="accessories_info" class="block-body collapse in">
      <br />
      <div class="field">
        <%= raw(@order.accessories) %>
        <br />
      </div>
    </div>
  </div>   
</div>

<div class="row-fluid">
  <div class="block span6" id='show-box-100' >
    <a href="#parts_info" class="block-heading" data-toggle="collapse"><%= t(:parts)%></a>
    <div id="parts_info" class="block-body collapse in">
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Serial number</th>
            <th>Cost</th>
            <th>Branch</th>
            <th></th>
            <th></th>
            <th></th>
          </tr>

          <% @order.parts.each do |part| %>
            <tr>
              <td><%= part.name %></td>
              <td><%= part.description %></td>
              <td><%= part.serial_number %></td>
              <td><%= part.cost %></td>
              <td><%= part.branch.name %></td>
              <td>         
                <ul class="nav nav-pills">
                  <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" title='<%=t(:actions)%>'><i class="icon-cog"></i>&nbsp;<i class="icon-caret-down"></i></a>
                    <ul class="dropdown-menu">
                      <%if can? :show, Part%>
                        <li>
                          <%= link_to part do %>
                            <i class="icon-eye-open"></i>&nbsp;&nbsp;<%=t(:show, :default => t("helpers.links.show"))%>
                          <%end%>
                        </li>
                      <%end%>
                    </ul>
                  </li>
                </ul>
              </td>
            </tr>
          <% end %>
          </tbody>
      </table>
    </div>
  </div>   
</div>   
<div class="row-fluid">
  <div class="block span6" id='show-box-100' >
    <a href="#clients_needs_info" class="block-heading" data-toggle="collapse"><%= t(:wclient_needs)%></a>
    <div id="clients_needs_info" class="block-body collapse in">
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Cost</th>
            <th>Branch</th>
            <th></th>
            <th></th>
            <th></th>
          </tr>

          <% @order.client_needs.each do |client_need| %>
            <tr>
              <td><%= client_need.name %></td>
              <td><%= client_need.description %></td>
              <td><%= client_need.cost %></td>
              <td><%= client_need.branch.name %></td>
              <td>         
                <ul class="nav nav-pills">
                  <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" title='<%=t(:actions)%>'><i class="icon-cog"></i>&nbsp;<i class="icon-caret-down"></i></a>
                    <ul class="dropdown-menu">
                      <%if can? :show, ClientNeed%>
                        <li>
                          <%= link_to client_need do %>
                            <i class="icon-eye-open"></i>&nbsp;&nbsp;<%=t(:show, :default => t("helpers.links.show"))%>
                          <%end%>
                        </li>
                      <%end%>
                    </ul>
                  </li>
                </ul>
              </td>
            </tr>
          <% end %>
          </tbody>
      </table>
    </div>
  </div> 
</div>


<div class="row-fluid">
  <div class="block span6" id='show-box-100' >
    <a href="#progresses_info" class="block-heading" data-toggle="collapse"><%= t('activrecord.models.progresses')%><span class="label label-warning"><%=t(:total_due)%>: <%=@order.total_due%></span></a>
    <div id="progresses_info" class="block-body collapse in">
      <table class="table">
        <thead>
          <tr>
            <th>Short description</th>
            <th>Full description</th>
            <th>User</th>
            <th></th>
            <th></th>
            <th></th>
          </tr>
          <% @order.progresses.each do |progress| %>
            <tr>
              <td><%= progress.short_description %></td>
              <td><%= progress.full_description %></td>
              <td><%= progress.user.fullname %></td>
              <td>         
                <ul class="nav nav-pills">
                  <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" title='<%=t(:actions)%>'><i class="icon-cog"></i>&nbsp;<i class="icon-caret-down"></i></a>
                    <ul class="dropdown-menu">
                      <%if can? :show, Progress%>
                        <li>
                          <%= link_to progress do %>
                            <i class="icon-eye-open"></i>&nbsp;&nbsp;<%=t(:show, :default => t("helpers.links.show"))%>
                          <%end%>
                        </li>
                      <%end%>
                      <%if can? :edit, Progress%>
                        <li>
                          <%= link_to edit_progress_path(progress) do %>
                            <i class="icon-pencil"></i>&nbsp;&nbsp;<%=t(:edit, :default => t("helpers.links.edit"))%>
                          <%end%>
                        </li>
                      <%end%>
                      <%if can? :destroy, Progress%>
                        <li>
                          <%= link_to  progress, :method => :delete, :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) } do %>
                            <i class="icon-trash"></i>&nbsp;&nbsp;<%=t(:destroy, :default => t("helpers.links.destroy"))%>
                          <%end%>
                        </li>
                      <%end%>
                    </ul>
                  </li>
                </ul>
              </td>
            </tr>
          <% end %>
          </tbody>
      </table>
    </div>
  </div> 
</div>



<div class="form-actions">
  <%if can? :index, Order%>
    <%= link_to t(:back, :default => t("helpers.links.back")),
      orders_path, :class => 'btn'  %>
  <%end%>
  <%if can? :edit, Order%>
    <%= link_to t(:edit, :default => t("helpers.links.edit")),
      edit_order_path(@order), :class => 'btn' %>
  <%end%>
  <%if can? :destroy, Order%>
    <%= link_to t(:destroy, :default => t("helpers.links.destroy")),
      order_path(@order),
      :method => 'delete',
      :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
      :class => 'btn btn-danger' %>
  <%end%>
  <%if can? :new, Order%>
    <%= link_to t(:new, :default => t("helpers.links.new")),
      new_order_path,
      :class => 'btn btn-primary', :title => t(:new) %>
  <%end%>
  <%if can? :new, Progress%>
    <%= link_to t(:add_new_progress),
      new_progress_path(:order_id => @order.id),
      :class => 'btn btn-primary', :title => t(:new) %>
  <%end%>
</div>
